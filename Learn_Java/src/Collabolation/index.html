<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
    <title>Collaborative Editor</title>
</head>
<body>

    <h1>Collaborative Editor</h1>

    <textarea id="editor" rows="10" cols="50"></textarea>

    <script>
        // ランダムなuserIdを生成（実際のアプリケーションではユーザーの認証後に適切なユーザーIDを取得する）
        var userId = "user" + Math.floor(Math.random() * 1000);

        var socket = new WebSocket("ws://localhost:8080/your-web-app/CollaborativeEditorSocket");

        document.getElementById("editor").addEventListener("input", function () {
            var editedText = document.getElementById("editor").value;
            var data = "userId=" + userId + "&editedText=" + editedText;
            sendToServer(data);
        });

        socket.onmessage = function (event) {
            var message = event.data;
            updateEditor(message);
        };

        function sendToServer(data) {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "CollaborativeEditorServlet", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send(data);
        }

        function updateEditor(message) {
            var parts = message.split(",");
            var senderId = parts[0];
            var editedText = parts[1];

            // 他のユーザーが文字を削除した場合、エディタを更新
            document.getElementById("editor").value = editedText;
        }
    </script>
    var socket = new WebSocket('ws://your-websocket-server');

    // ウェブソケットがオープンしたときの処理
    socket.onopen = function(event) {
        console.log('WebSocket opened');
    };
    
    // ウェブソケットがメッセージを受信したときの処理
    socket.onmessage = function(event) {
        var receivedData = event.data;
        
        // テキストエリアに反映
        updateTextareaWithListData(receivedData);
    
        // 他のクライアントに通知
        notifyOtherClients(receivedData);
    };
    
    // リストの要素がクリックされたときの処理
    $(document).on("click", "#sampleList li", function() {
        var selectedItemContent = $(this).data('content');
    
        // ウェブソケットを介して他のクライアントにデータを送信
        socket.send(selectedItemContent);
    
        // テキストエリアに反映
        updateTextareaWithListData(selectedItemContent);
    
        // 他のクライアントに通知
        notifyOtherClients(selectedItemContent);
    });
    
    // テキストエリアを更新する関数
    function updateTextareaWithListData(listData) {
        var textarea = $("#sharedTextarea");
        textarea.val(listData);
    }
    
    // 他のクライアントに通知する関数
    function notifyOtherClients(data) {
        // ここで適切な処理を行い、改行を含むデータを送信
        // 例えば、サーバーサイドで改行を適切に処理して他のクライアントにブロードキャストする
        console.log("他のクライアントに通知: " + data);
    }

// テキストエリアを更新する関数
function updateTextareaWithListData(listData) {
    var textarea = $("#sharedTextarea");
    textarea.val(listData);
}

// 別のデータを更新する関数
function updateOtherData(data) {
    // ここで他のデータを適切に更新する処理を行う
    console.log("他のデータを更新: " + data);
}

</body>
</html>
